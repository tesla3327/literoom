# Research Synthesis: Project Scaffolding

**Date**: 2026-01-20
**Status**: Complete
**Research Plan**: [2026-01-20-project-scaffolding-research-plan.md](./2026-01-20-project-scaffolding-research-plan.md)

## Executive Summary

This document synthesizes research findings for scaffolding a Nuxt 4 + Nuxt UI 4 + Rust WASM monorepo project. The stack is mature and well-supported as of 2026, with clear best practices established.

---

## 1. Nuxt 4 Setup

### Current State
- **Nuxt 4** launched mid-2025 as a stability-focused release
- Current version: **4.2.2** (as of December 2025)
- Nuxt 3 maintenance continues until end of January 2026

### Key Changes from Nuxt 3
1. **New `app/` directory structure** (recommended but not required)
   - Application code lives in `app/` isolated from root-level files
   - Flat structure still works for compatibility
2. **`sharedPrerenderData`** now stable and default for SSG
3. **`@nuxt/fonts`** module auto-downloads and self-hosts fonts

### Installation

```bash
# Create new Nuxt 4 project
pnpm dlx nuxi init <app-name> -t v4-compat

# Or install in existing project
pnpm add nuxt@^4.0.0
```

### Recommended Configuration

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  future: {
    compatibilityVersion: 4,
  },
  modules: ['@nuxt/ui'],
  devtools: { enabled: true },
})
```

**Sources**: [Nuxt 4 Installation](https://nuxt.com/docs/4.x/getting-started/installation), [Nuxt 4 Announcement](https://nuxt.com/blog/v4)

---

## 2. Nuxt UI 4 Integration

### Current State
- **Nuxt UI v4** unified Nuxt UI and Nuxt UI Pro into single open-source library
- NuxtLabs joined Vercel in July 2025, making 100+ components free
- Active development with January 2026 commits

### Key Features
- Built on **Reka UI** (accessible primitives) + **Tailwind CSS** + **Tailwind Variants**
- Works with both Nuxt and standalone Vue projects
- Full Figma Kit available

### Installation

```bash
pnpm add @nuxt/ui@^4.0.0
```

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  modules: ['@nuxt/ui'],
  css: ['~/assets/css/main.css']
})
```

```css
/* assets/css/main.css */
@import "tailwindcss";
@import "@nuxt/ui";
```

**Sources**: [Nuxt UI Installation](https://ui.nuxt.com/docs/getting-started/installation/nuxt), [Nuxt UI Releases](https://ui.nuxt.com/releases)

---

## 3. Rust WASM Integration with Vite

### Recommended Approach: vite-plugin-wasm

The `vite-plugin-wasm` package is the most maintained and widely used solution, supporting Vite 2.x through 6.x.

### Installation

```bash
pnpm add -D vite-plugin-wasm vite-plugin-top-level-await
```

### Configuration

```typescript
// nuxt.config.ts
import wasm from 'vite-plugin-wasm'
import topLevelAwait from 'vite-plugin-top-level-await'

export default defineNuxtConfig({
  vite: {
    plugins: [wasm(), topLevelAwait()]
  }
})
```

### Building Rust WASM

Use `wasm-pack` with `--target web` for worker compatibility:

```bash
wasm-pack build --target web --out-dir ../web/wasm
```

### Web Worker Integration

For WASM in Web Workers, the recommended approaches are:

1. **Simple approach**: Create worker JS file that imports WASM
2. **wasm-bindgen-rayon**: For parallel computing with SharedArrayBuffer
3. **wasm-mt crate**: Cross-browser multithreading without SharedArrayBuffer

**Key consideration**: Most browsers throw exceptions when blocking the main thread with shared-memory WASM. Keep WASM modules off the main thread.

**Sources**: [vite-plugin-wasm](https://www.npmjs.com/package/vite-plugin-wasm), [wasm-bindgen Worker Guide](https://alexcrichton.github.io/wasm-bindgen/examples/wasm-in-web-worker.html), [WASM Threads Guide](https://github.com/kmdouglass/playground/tree/main/wasm-threads-bundler)

---

## 4. Monorepo Structure

### Recommended Directory Structure

```
literoom/
├── .github/
│   └── workflows/
│       └── ci.yml
├── apps/
│   └── web/                    # Nuxt 4 application
│       ├── app/                # Nuxt 4 app directory
│       │   ├── components/
│       │   ├── composables/
│       │   ├── layouts/
│       │   ├── pages/
│       │   └── app.vue
│       ├── server/             # Nitro server
│       ├── public/
│       ├── nuxt.config.ts
│       └── package.json
├── packages/
│   ├── core/                   # Shared TypeScript core logic
│   │   ├── src/
│   │   │   ├── catalog/        # Catalog service
│   │   │   ├── filesystem/     # FS abstraction layer
│   │   │   └── types/          # Shared types
│   │   └── package.json
│   └── wasm/                   # Rust crate output
│       └── package.json        # Generated by wasm-pack
├── crates/
│   ├── literoom-core/          # Rust image processing
│   │   ├── src/
│   │   │   ├── decode/         # RAW/JPEG decoding
│   │   │   ├── pipeline/       # Edit pipeline
│   │   │   ├── histogram/      # Histogram computation
│   │   │   └── lib.rs
│   │   └── Cargo.toml
│   └── literoom-wasm/          # WASM bindings
│       ├── src/
│       │   └── lib.rs
│       └── Cargo.toml
├── Cargo.toml                  # Workspace root
├── pnpm-workspace.yaml
├── package.json
└── README.md
```

### pnpm Workspace Configuration

```yaml
# pnpm-workspace.yaml
packages:
  - 'apps/*'
  - 'packages/*'
```

### Cargo Workspace Configuration

```toml
# Cargo.toml (root)
[workspace]
resolver = "2"
members = [
    "crates/literoom-core",
    "crates/literoom-wasm",
]

[workspace.dependencies]
wasm-bindgen = "0.2"
js-sys = "0.3"
web-sys = "0.3"
serde = { version = "1.0", features = ["derive"] }
```

### Cross-Package Dependencies

```json
// apps/web/package.json
{
  "dependencies": {
    "@literoom/core": "workspace:*",
    "@literoom/wasm": "workspace:*"
  }
}
```

**Sources**: [pnpm Workspaces](https://pnpm.io/workspaces), [Vue School Monorepo Guide](https://vueschool.io/articles/vuejs-tutorials/scalable-nuxt-3-monorepos-with-pnpm-workspaces/)

---

## 5. Testing Infrastructure

### Vitest (Unit Tests)

```bash
pnpm add -D @nuxt/test-utils vitest @vue/test-utils
```

```typescript
// vitest.config.ts
import { defineVitestConfig } from '@nuxt/test-utils/config'

export default defineVitestConfig({
  test: {
    environment: 'nuxt',
    environmentOptions: {
      nuxt: {
        domEnvironment: 'happy-dom',
      }
    }
  }
})
```

**Key utilities**:
- `mountSuspended` - Mount components with Nuxt context
- `mockNuxtImport` - Mock auto-imports

### Playwright (E2E Tests)

```bash
pnpm add -D @playwright/test
```

```typescript
// playwright.config.ts
import { defineConfig } from '@playwright/test'

export default defineConfig({
  testDir: './e2e',
  use: {
    baseURL: 'http://localhost:3000',
    trace: 'on-first-retry',
  },
  webServer: {
    command: 'pnpm dev',
    port: 3000,
    reuseExistingServer: !process.env.CI,
  },
})
```

### Rust Testing (from existing research)

Per [Rust Tooling Best Practices](../../thoughts/shared/research/2026-01-20-rust-tooling-best-practices.md):
- Use `cargo-nextest` for faster test execution
- Property-based testing with `proptest`
- Clippy with `-D warnings` in CI

**Sources**: [Nuxt 4 Testing Docs](https://nuxt.com/docs/4.x/getting-started/testing), [Playwright Integration](https://deepwiki.com/nuxt/test-utils/6.2-playwright-integration)

---

## 6. CI/CD Pipeline

### GitHub Actions Workflow

```yaml
# .github/workflows/ci.yml
name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  # TypeScript/Nuxt checks
  web:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: pnpm/action-setup@v4
        with:
          version: 9

      - uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'pnpm'

      - run: pnpm install

      - name: Lint
        run: pnpm lint

      - name: Type check
        run: pnpm typecheck

      - name: Unit tests
        run: pnpm test:unit

      - name: E2E tests
        run: pnpm test:e2e

      - name: Upload traces
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: playwright-traces
          path: apps/web/test-results/

  # Rust/WASM checks
  rust:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt

      - uses: Swatinem/rust-cache@v2

      - name: Format check
        run: cargo fmt --all -- --check

      - name: Clippy
        run: cargo clippy --all-targets -- -D warnings

      - name: Tests
        run: cargo nextest run --all-features

      - name: WASM build
        run: |
          cargo install wasm-pack
          cd crates/literoom-wasm
          wasm-pack build --target web
```

**Sources**: [Rust Tooling Best Practices](../../thoughts/shared/research/2026-01-20-rust-tooling-best-practices.md), [Nuxt GitHub Actions Guide](https://mayashavin.com/articles/github-actions-deploy-nuxt)

---

## 7. File System Abstraction Layer

### Design Pattern

Create an abstraction interface that works in both browser (File System Access API) and Tauri:

```typescript
// packages/core/src/filesystem/types.ts
export interface FileSystemProvider {
  // Directory operations
  selectDirectory(): Promise<DirectoryHandle>
  listDirectory(handle: DirectoryHandle): Promise<FileEntry[]>

  // File operations
  readFile(handle: FileHandle): Promise<ArrayBuffer>
  writeFile(handle: FileHandle, data: ArrayBuffer): Promise<void>

  // Persistence
  saveHandle(key: string, handle: DirectoryHandle): Promise<void>
  loadHandle(key: string): Promise<DirectoryHandle | null>
  checkPermission(handle: DirectoryHandle): Promise<PermissionState>
}

export interface DirectoryHandle {
  name: string
  // Implementation-specific internal handle
}

export interface FileEntry {
  name: string
  kind: 'file' | 'directory'
  handle: FileHandle | DirectoryHandle
}
```

### Browser Implementation (File System Access API)

```typescript
// packages/core/src/filesystem/browser.ts
export class BrowserFileSystemProvider implements FileSystemProvider {
  async selectDirectory(): Promise<DirectoryHandle> {
    const handle = await window.showDirectoryPicker()
    return wrapHandle(handle)
  }

  async listDirectory(handle: DirectoryHandle): Promise<FileEntry[]> {
    const native = unwrapHandle(handle)
    const entries: FileEntry[] = []
    for await (const entry of native.values()) {
      entries.push({
        name: entry.name,
        kind: entry.kind,
        handle: wrapHandle(entry)
      })
    }
    return entries
  }

  // ... other methods
}
```

### Tauri Implementation (future)

```typescript
// packages/core/src/filesystem/tauri.ts
import { open, readDir, readFile, writeFile } from '@tauri-apps/plugin-fs'

export class TauriFileSystemProvider implements FileSystemProvider {
  // Implementation using Tauri fs plugin
}
```

### Provider Detection

```typescript
// packages/core/src/filesystem/index.ts
export function createFileSystemProvider(): FileSystemProvider {
  if (window.__TAURI__) {
    return new TauriFileSystemProvider()
  }

  if ('showDirectoryPicker' in window) {
    return new BrowserFileSystemProvider()
  }

  throw new Error('No supported file system API available')
}
```

**Sources**: [Tauri File System Plugin](https://v2.tauri.app/plugin/file-system/), [File Operations System](https://deepwiki.com/tauri-apps/tauri-plugin-fs/2.1-file-operations-system)

---

## 8. Development Tooling Configuration

### ESLint + Prettier

```bash
pnpm add -D @nuxt/eslint eslint prettier
```

```typescript
// eslint.config.mjs
import { createConfigForNuxt } from '@nuxt/eslint-config/flat'

export default createConfigForNuxt({
  features: {
    tooling: true,
    stylistic: true,
  },
})
```

### TypeScript Configuration

```json
// tsconfig.json
{
  "extends": "./.nuxt/tsconfig.json"
}
```

### Rust Tooling (per existing research)

```toml
# rustfmt.toml
edition = "2021"
max_width = 100
tab_spaces = 4
newline_style = "Unix"
```

```toml
# clippy.toml
cognitive-complexity-threshold = 25
```

---

## Recommendations Summary

| Area | Recommendation | Confidence |
|------|----------------|------------|
| Framework | Nuxt 4.2.x | High |
| UI Library | Nuxt UI 4.x | High |
| WASM Plugin | vite-plugin-wasm + vite-plugin-top-level-await | High |
| Monorepo | pnpm workspaces + Cargo workspace | High |
| Unit Testing | Vitest + @nuxt/test-utils | High |
| E2E Testing | Playwright | High |
| Rust Testing | cargo-nextest + proptest | High |
| CI/CD | GitHub Actions | High |
| FS Abstraction | Custom interface pattern | Medium |

---

## Next Steps

1. Create implementation plan with step-by-step scaffolding instructions
2. Initialize project structure
3. Set up CI/CD pipeline
4. Implement file system abstraction layer
